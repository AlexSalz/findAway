# 3 系统关键技术和设计
社区医疗检测系统可以准确、便捷、较低成本的实现对社区用户尤其为老年人身体健康状态的检查，而对用户的日常生活几乎没有影响，日常活动没有限制。可以有效的提高社区内老年人的老年生活质量和社区医疗保健水平。传统的社区健康监护系统的监测设备体积庞大不易移动，操作繁杂切维护成本高，且当老年人处于一定的特殊情况如外出时，无法进行其身体状态的监测，老人面对突发状况也无法及时发出求助信息，极大的限制了社区医疗的积极进行。传统的社区健康监护系统已经不再适合现代需要社区医疗检测的用户，特别是正对老年人的长期的、动态的、要求低成本且不影响用户行动的监测。【3.5】
## 3.1 无线传感网络技术概括
伴随着计算机网络及通信技术的飞速发展，人们对于无线通信的要求越来越高。无线传感网络，是由大量部署在需要检测区域的微型传感器节点组成，
再加上综合了嵌入式计算技术、网络通信技术、分布式信息处理技术和微电子集成化制造技术等等，能够实现对各种环境或检测对象的信息的实时感知、监测、采集和传输。这些信息被采集之后进行处理，通过无线自组织网络以多跳中继的方式将信息传送给不同情况下所要求的节点。一种普遍为人们所接受的无线传感网络定义是：无线传感网络是具备大规模，无基础设施支持的，有着自组织和多跳中继等特点的无线网络。在这个无线网路中，网络节点是同构的，价格低廉，体积小但具有低功耗的性质。大部分节点被随意或固定在被要求检测区域，这也需要网络尽可能的长时间处于工作状态下，或者休眠模式低功耗，以达到很好的使用寿命，减少维护或更换成本与周期。【清华】
而随着互联网终端技术的发展，物联网可穿戴设备的普及，为远程医疗监护提供了更好的发展技术与平台。社区医疗检测系统为空巢老年人提供了一种全新的医疗监护方式，它可以更好的融合现代医疗技术和现代无线信息技术的优点，可以为用户带来不受时间和地域限制的专业医疗监护服务。不仅可以有效的提高老年人的生活质量和社区医疗保健水平，也极大的减少了医疗专员对于长期陪伴式监护资源的浪费，同时还可以实现对于健康监护，慢性疾病的预防和治疗，降低了养老成本。【3.5】
本小节通过分析目前应用广泛的数种无线通信技术，同时考虑到社区医疗检测系统面向群体的特殊性以及其使用范围的较为固定的特点，来确定本系统的组网以及无线通信的方式。
（1）红外数据传输（IrDA）
红外数据传输（Infrared Data Association）是一种点对点的数据传输协议，通信需要波长为900nm左右的近红外线为介质，通信距离很短，为0～1m，传输速率可达16M/s。其传输具备数据直线传输、安全性强、传输速度高、距离短，需要一定的通信视角等特点。但它是一种视距传输，只能满足两台通讯设备之间的对准连接及信息传输。
（2）蓝牙
蓝牙（BlueTooth）是爱立信公司首先提出，由philips半导体和Sony联合推出的短距离无线通行技术解决方案。BlueTooth工作在全球开放频段的2.4GHz IISM频段，采用了调频频谱扩展技术，通信需要2.402～2.480GHz的电磁波作为介质，通信距离在以10m为半径的范围内，有效的使用了无线连接代替广泛使用的有线连接。BlueTooth技术能够实现点对多的通信环境，覆盖范围大，组网简单，通信速率可达1Mb/s。
（3）Wi-Fi
WI-FI（Wireless Fidelity）通常是指一种IEEE802.11b产品，提供了一种利用无线接入的新型局域网解决方案。通信覆盖范围大，但网络安全性差。
（4）Zigbee
Zigbee技术是一组基于IEEE 802.15.4无线标准，针对低速率网络童星研制开发的小范围、低功耗的无线通信传感技术。可工作全球流行2.4GHz、欧洲流行868MHz以及美国流行915MHz三个常见频段上。可以嵌入各种设备。
[3.5。31]它本身的特点是的其在工业监控、传感器网络、智能家居、安全系统、远程控制等领域有很大的发展空间。
以上对比分析了集中典型的短距离无线传输的技术特性。其中，红外技术实现简单，但可移动性差，无法灵活组建网络。蓝牙技术在计算机外设方面有广泛的应用，但其协议规范复杂，技术实现成本高，节点功耗大。Wi-FI技术适合于多媒体应用，网络安全性能低，实现成本高且功耗大。Zigbee技术以其低功耗、成本低、可靠的优点有着广泛的应用前景。基于社区医疗检测系统的特点：
（1）系统监护对象主要为社区空巢老年人，要求用户使用方便，移动性强，覆盖范围广，影响用户的日常生活。
（2）用户的健康数据可以实时监控发送，且要健康数据隐私安全的到保障。
（3）要求系统局域网组网成本低且组网灵活，便于社区分组管理或者集中管理。
基于社区医疗检测系统的以上特点，系统最终决定使用Zigbee技术实现系统的无线通信。

## 3.2 Zigbee技术
社区医疗检测系统的主要监护对象是老年人，对局域网饿稳定性要求高。Zigbee有很强的自组网能力，网络节点能自行判断是否加入一个网络及其在加入网络后扮演的角色，从而组成结构化的网络。其稳定性体现在网络中新加入或者退出一个节点、节点发生移动、节点故障，网络都能够进行自我修复，通过调整网络拓扑结构，自主实现重新组网，确保了网络整体的稳定性。因此社区医疗检测系统的无线传感网络采用的是Zigbee技术。
### 3.2.1 Zigbee技术主要特点
1. 功耗低
Zigbee网络节点设备的数据传输量低，收发数据信息功耗低；同时使用了休眠模式，且在数据传输过程中对信道检测实现严格管理信道工作与空闲时间比例和帧运作。一节5号电池可为其提供长达六个月左右的工作功耗，避免了频繁更换电池或充电，较少了维护成本。
2.  可靠性高
 碰撞避免策略的采用并且预留专业时隙，可以有效的规避收发数据时的竞争和冲突。在根本上采用MAC层完全确认的数据传输机制，确保了数据在传输过程的可靠性。
3.  安全性好
 Zigbee技术加密算法采用ASE-128，从而使网络安全的到保障，提高了数据传输工程中的安全性。
4.  容量大
 Zigbee网络在理论上可以在同一网络中容纳成千上万个节点设备，网络组成灵活。
5.  兼容性
Zigbee技术通过网络协调器自动组建网络，采用载波侦听/CMSMACA方式进行信道接入。【清华】提供全握手协议。
6.  延时短
 Zigbee技术优化了通讯延时，通过缩短休眠到激活状态的转换延时，适用于对延时要求苛刻的无线控制场景。一般延时在15至30ms之间。
7.  有效范围大
 Zigbee网络依据实际发射功率大小和不同的应用场景，通过增加路由器的途径对网络距离拓展，可实现覆盖范围达数千米以上，适合办公场所和社区组网。
### 3.2.2 Zigbee协议框架
Zigbee堆栈参考OSI (Open System interconnection )的分层思路，基于IEEE 802.15.4标准，定义了协议的MAC层和PHY层。
完整的Zigbee协议栈包括物理层 、介质访问控制层（MAC）、安全层、高层应用规范和网络层。如图所示：
::【3.5 P30】。 【清华P35】配图::
每一层都有着不同的功能，相邻饿两个层间进行数据的传递流动。这五层的功能分别是：
物理层（PHY）：是整个协议栈的最基础部分，设定如何使用频段范围，收发物理信号，调整收发机状态以及参数设置。
介质访问控制层（MAC）：为访问物理层提供通信接口，提供可靠性授权和一跳通信连接，在网络当中可以调配通信资源使多个设备得到合理的协调控制，控制物理层各信号节点如何利用通信资源进行通信。
网络层（NWK）：主要用于发现构建新网络拓结构的路由，提供多跳功能，同时判断节点与自网络的隶属关系。
应用程序支持子层（APS）：属于应用层的一个组成部分，为网络层和应用层提供通信接口，提供数据传输及管理服务，并可以使应用和协议栈交互。
应用层（APL）：是Zigbee协议结构的最高层，含有应用支持子层，应用框架（AF）和Zigbee设备对象。优化网络节点且提供通讯接口给网络终端。
由此可见，Zigbee协议定义了网络的网络层、应用程序支持层和应用层；
IEEE 802.15.4规范定义了网络里的物理层和截至访问控制层，二者通过定义不同层的协议来实现Zigbee无线网络的构建。而Zigbee网络安全体系则在MAC层和NWK层都采取了安全策略。MAC层提供保证单跳链路的安全机制。::[机械p46]::NWK层提供的安全机制可以使设备间的多跳报文可靠传输。
## 3.3 Zigbee建网和入网
Zigbee网络只支持两种类型的物理设备：全功能设备（Full Function Device，FFD）和精简功能设备（Reduced Function Device，RFD）。
FFD设备可以充当任何Zigbee类型的节点，具有收发数据、收纳子节点、充当路由的功能，包括协调器（Coordinator）和路由器（Router）。RFD设备只能充当子节点，为终端节点设备（End Device）。每种设备都有各自的功能：
协调器：一个网络有且仅有的一个PAN协调器，是一个网络构建的第一个设备，负责网络的启动，配置网络信道和网络标识符（PAN ID）。组建网络后，还要完成分配网络节点地址、绑定节点、建立安全层等后期维护。
路由器：允许设备加入网络，整个无线数据网络中的数据转发中心，扩展网络覆盖的物理范围从儿扩大通信范围。
终端设备：实现Zigbee网络边缘的数据的原始采集，常用监控对象连接在一起。
### 3.3.1 网络拓扑结构
Zigbee具有三种网络拓扑结构：星状、树状、和网状。
::配图：三种网络拓扑结构::
星状网络：一个PAN协调器节点作为整个系统网络的网关，其余一个或多个终端设备都只与协调器通信，节点之间通信必须经过协调器进行转发。所以当出现大量数据的通信时，网络容易出现丢包性能减退等问题。
树状网络：可以视为多个星状拓扑网络集合而成。终端设备可以加入协调器也可以加入路由器，设备可以和父节点及子节点进行直接通信；与其他设备通信需要将信息发送给父节点，再由父节点传送给协调器，协调器再进行转发。具有良好的节点同步性。但是由于覆盖范围大导致动态性差，整个通信系统可能因为节点故障出现瘫痪。
网状网络：是一种复杂程度更高的类似树状网络，但与树状网络最大的不同是除协调器外，各节点都具备路由转发功能，可以直接把消息发送给其他节点。这样的网络减少了信息传输延时，自我修复能力强，但需要更多的存储资源来对路由表进行保存。
### 3.3.2 Zigbee网络组建与入网
Zigbee网络的组建包括网络初始化和节点加入网落两个步骤。而节点加入网络有两种入网方式，分别为通过协调器加入网络，通过已有节点加入网络。
1）网络的初始化
协调器发起Zigbee网络的建立。这就要求节点组建网络时：节点是具有协调器功能的FFD节点，节点未加入其他网络。一个PAN网络中有且只有一个协调器。初始化流程如图，具体说明如下：
::【机械。p246】配图::
选定网络协调器：在一个节点上电激活之后，首先会判断自身是否为具有成为Zigbee协调器功能的FFD节点，并且会检查节点是否已经加入其他网络。之后进行主动扫描，发送一个信标请求。在扫描期限时间内，如果检测不到信标，那么该节点可以作为协调区自己组建Zigbee网络，并且可以不断广播信标。若监测到了信标，它就会加入源地址的协调器建立的网络。协调器设备要先扫描信道，然后建立网络。
信道扫描：对指定信道进行能量扫描，再对通信范围内进行主动扫描搜集网络信息。若默认信道列表指定了信道，则只需主动扫描确定网络配置。
网络配置：选择好信道之后，协调器将在创建一个新网络的同时，产生一个同一信道内不与其他网络冲突的PAN ID。等待其他节点加入。
2）通过协调器加入网络
::配图 [机械。p247]::
节点会主动扫描信道里的信标，来获得所有网络信息，在决定加入一个网络之后，会向这个网络发送关联请求命令帧。协调器在接收到之后，会立即回复确认帧，以及关联响应请求帧。协调器收到数据请求后，立即回复确认帧，并且发送关联响应命令。节点在收到后，会回复确认帧，并根据协调器发送过来的短地址和扩展地址，通告加入成功。
3）通过一已存在FFD节点入网
FFD节点与协调器关联成功后，处于这个网络中的其他节点就可以选择FFD节点作为父节点从而加入网络。可以以关联方式即设备使用MAC关联程序入网；也可以以直接方式即子设备直接同一个已指定了的父节点设备进行关联来加入网络。::[机械。248]::
## 3.4 Zigbee网络通讯方式
Zigbee网络通信方式包括四种：单播，广播，组播，绑定。
单播：在Zigbee网络里，模块之间要进行通信，发送模块非常明确的知道接受模块的地址，并且以这个地址发送数据给接受模块的通信方式，叫做单播。
组播：在Zigbee网络中，将模块用分组来标记，如果发送模块发送的组播组ID号和网络里标记模块的组ID号对应，那么组播表中该组ID下所有设备都可以接收发送模块的信息。
广播：在Zigbee网络中的任何一个设备发送出数据，这个网络里的所有节点模块都可以接收这个信息。
绑定：Zigbee具有四种绑定方式，其在TI_Z-Stack协议栈中的应用分别是两个节点分别通过按键机制调用ZDP_EndDeviceBindReq函数、Match方式、ZDP_BindReq和ZDP_UnbindReq方式、手工管理绑定表。

































#论文